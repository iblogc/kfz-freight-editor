# 孔夫子旧书网 - 出售中商品运费模板批量修改工具

这是一个专为孔夫子旧书网（kongfz.com）卖家设计的桌面 GUI 工具。它可以根据预设的价格区间，自动筛选并批量修改“出售中”商品的运费模板。

## 核心功能

- **海量数据支持**：核心逻辑为**流式读写模式**，支持处理数十万级别的超大规模商品数据，内存占用极低且运行稳定。
- **高可靠性保障**：采用 `.tmp` 临时文件原子写入机制，即便处理过程中途断电或崩溃，亦能确保本地已抓取的数据安全不丢失。
- **UI 交互增强**：
    - 实时着色日志系统（INFO/WARNING/ERROR）。
    - 一键快捷键：支持快速打开输出目录及日志目录。
    - 运行状态锁定：执行期间自动禁用输入，防止误操作。
- **Windows 完美兼容**：所有导出文件均采用 `utf-8-sig` 编码，确保在 Windows Excel 中直接打开不乱码。
- **自动化全流程**：从登录校验、规则匹配、商品导出到批量修改，一键完成。

## 技术栈

- **核心**: Python 3.12+
- **GUI**: `Tkinter` (原生轻量化)
- **网络**: `requests`
- **处理**: 分块流式 I/O (Chunked Streaming I/O)
- **打包**: `Nuitka` (高性能单文件封装)

## 快速开始

### 1. 环境准备

建议使用 [uv](https://github.com/astral-sh/uv) 管理。

```bash
uv sync
```

### 2. 运行程序

```bash
python main.py
```

### 3. 使用流程

1. **配置规则**：编辑 `运费修改模板.csv`。
2. **选择模板**：在 UI 中选择该 CSV。
3. **账户认证**：输入孔网账号密码。
4. **监控进度**：点击“开始执行”，观察实时日志。
5. **查收结果**：任务结束后点击“打开输出目录”提取汇总报告和明细。

## 构建可执行文件

项目提供了 Nuitka 打包脚本，可以将程序打包成单文件的 `.exe` (Windows) 或可执行二进制文件 (macOS/Linux)。

```bash
python scripts/build_nuitka.py
```

生成的文件将位于 `build/` 目录下。

## 项目结构

```
kfz-freight-editor/
├── src/
│   ├── api.py         # 孔网 API 封装
│   ├── gui.py         # Tkinter GUI 界面实现
│   ├── logic.py       # 批量处理业务逻辑
│   ├── login.py       # 登录管理与验证
│   └── utils.py       # 日志与辅助函数
├── scripts/
│   └── build_nuitka.py # 打包脚本
├── main.py            # 程序入口点
└── pyproject.toml     # 项目依赖配置
```

## 注意事项

- **安全性**：本工具仅用于辅助卖家管理商品，请妥善保管账号权限。
- **频率限制**：程序内置了简单的延时机制以避免请求过快，建议在运行期间不要进行大并发操作。
- **数据备份**：程序在修改前会将商品数据抓取到本地，建议在执行大规模修改前先核对生成的 CSV 文件。